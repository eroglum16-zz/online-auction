{"version":3,"file":"static/webpack/static/development/pages/s/[id].js.f81c0db60ff709a886bc.hot-update.js","sources":["webpack:///./components/ChatBox.js","webpack:///./pages/s/.js"],"sourcesContent":["import React from \"react\";\nimport { Card, CardHeader, CardBody, CardFooter} from 'reactstrap';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faPaperPlane } from '@fortawesome/free-solid-svg-icons'\nimport 'react-chat-elements/dist/main.css';\nimport { MessageList, Input, Button } from 'react-chat-elements';\nimport {serverUrl} from '../api-config';\nimport axios from 'axios';\nimport socketIOClient from 'socket.io-client';\n\nconst socket = socketIOClient(apiConfig.serverUrl);\n\nclass ChatBox extends React.Component{\n    constructor(props) {\n        super(props);\n        this.state = {\n            message: '',\n            messages: []\n        };\n        this.handleInputChange  = this.handleInputChange.bind(this);\n        this.handleEnter        = this.handleEnter.bind(this);\n        this.handleSendClick    = this.handleSendClick.bind(this);\n    }\n    componentDidMount() {\n        this.getMessages();\n        if (this.state.messages.length === 0){\n            let intervalId;\n            intervalId = setInterval(() => {\n                this.getMessages();\n                if (this.state.messages.length !== 0){\n                    clearInterval(intervalId);\n                }\n            }, 500);\n        }\n        socket.on('new message on ' + this.props.saleId, (msg) => {\n            if(msg.receiverEmail === this.props.userEmail)\n                this.getMessages();\n        });\n    }\n    handleInputChange(event) {\n        const target = event.target;\n        const value = target.value;\n\n        this.setState({\n            message: value,\n        });\n    }\n    handleEnter(event) {\n        if (event.key === 'Enter') {\n            this.sendMessage();\n        }\n    }\n    handleSendClick(){\n        this.sendMessage();\n    }\n    sendMessage(){\n        const url = serverUrl + '/message/new';\n        axios.post(url, {\n            text: this.state.message,\n            receiverEmail: this.props.receiverEmail,\n            saleId: this.props.saleId\n        },{\n            headers:{\n                authorization: this.props.userToken\n            }\n        }).then((response) => {\n            console.log(response.data);\n            this.setState({\n                message: ''\n            });\n            socket.emit('new message', {\n                relatedSale: this.props.saleId,\n                receiverEmail: this.props.receiverEmail\n            });\n            this.refs.message.clear();\n            this.getMessages();\n        }).catch((error) => {\n            throw error;\n        });\n    }\n    getMessages(){\n        console.log(\"Sale ID: \"+this.props.saleId);\n        console.log(\"Token: \"+this.props.userToken);\n        const url = serverUrl + '/messages/' + this.props.saleId;\n        axios.post(url, {}, {\n            headers:{\n                authorization: this.props.userToken\n            }\n        }).then((response) => {\n            this.setState({\n                messages: response.data.messages\n            });\n        }).catch((error) => {\n            console.log(error);\n        });\n    }\n\n    render() {\n        let dataSource = [];\n        let messages = this.state.messages;\n        let i;\n        for (i in messages){\n            dataSource.push({\n                position: messages[i].receiverEmail === this.props.receiverEmail ? 'right' : 'left',\n                type: 'text',\n                className: 'mb-2',\n                text: messages[i].messageText,\n                date: messages[i].createdAt\n            });\n        }\n        return (\n            <div>\n                <Card>\n                    <CardHeader className=\"bg-dark text-white\">\n                        {this.props.buyer}\n                        <span className=\"float-right\"> {this.props.salePrice}₺ </span>\n                    </CardHeader>\n                    <CardBody style={{minHeight: '400px'}}>\n                        <MessageList\n                            className='message-list'\n                            lockable={true}\n                            toBottomHeight={'100%'}\n                            dataSource={dataSource} />\n                    </CardBody>\n                    <CardFooter className=\"bg-light\">\n                        <Input\n                            placeholder=\"Mesajınız...\"\n                            className=\"pl-2\"\n                            multiline={false}\n                            ref=\"message\"\n                            value={this.state.message}\n                            onChange={this.handleInputChange}\n                            onKeyDown={this.handleEnter}\n                            rightButtons={\n                                <Button\n                                    color='white'\n                                    className='bg-dark col-2'\n                                    onClick={this.handleSendClick}\n                                    text={<FontAwesomeIcon icon={faPaperPlane} width=\"16\" />} />\n                            }/>\n                    </CardFooter>\n                </Card>\n\n            </div>\n        );\n    }\n}\n\nexport default ChatBox;","import Layout from '../../components/AppLayout';\nimport ChatBox from \"../../components/ChatBox\";\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport { Button, Form, FormGroup, Input, InputGroup, InputGroupAddon, InputGroupText } from 'reactstrap';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faLiraSign, faUser, faMoneyBill, faUsers, faThumbsUp, faCalendarAlt } from '@fortawesome/free-solid-svg-icons'\nimport Link from \"next/link\";\nimport {auth, getUser} from \"../../utils/auth\";\nconst defaults = require('../../utils/defaults');\nconst apiConfig = require('../../api-config');\nimport {getSale} from \"../../utils/api\";\nimport {toTimeString} from \"../../utils/miscellaneous\";\nimport Router from 'next/router'\n\nclass Sale extends React.Component{\n    constructor(props) {\n        super(props);\n        let token = this.props.token;\n        this.state = {\n            loggedIn: !!token,\n            user: {},\n            sale: defaults.defaultSale,\n            maxBid: {\n                amount: 0,\n                bidder: {\n                    email: \"\",\n                    nameSurname: \"\"\n                }\n            }\n        };\n    }\n    componentDidMount() {\n        getUser(this.props.token).then(user => {\n            this.setState({\n                user: user\n            });\n        });\n        getSale(this.props.id).then(response => {\n            if (!response){\n                Router.push('/sales');\n                return;\n            }\n            this.setState({\n                sale: response.sale,\n                maxBid: response.maxBid\n            });\n        });\n    }\n\n    render() {\n        const buyer = this.state.maxBid.bidder.nameSurname;\n        const salePrice = this.state.maxBid.amount;\n        return (\n            <Layout page=\"me\" user={this.state.user} loggedIn={this.state.loggedIn}>\n                <div className=\"container bg-white\"\n                     style={{ padding:'3%', marginTop:'3%', boxShadow: '0px 10px 5px 0px #ccc'}} >\n                    <div className=\"row\">\n                        <div className=\"col-md-1\"></div>\n                        <div className=\"col-md-5\">\n                            <div className=\"mb-3\" style={{maxHeight: '400px', overflow: 'hidden'}}>\n                                <img src={apiConfig.productImageBase + this.state.sale.images[0]} width=\"100%\" />\n                            </div>\n                            <h4> {this.state.sale.title} </h4>\n                            <hr/>\n                            <div className=\"row mt-4\">\n\n                                <p className=\"col-md-6 \">\n                                    <FontAwesomeIcon icon={faUser} width=\"16\" /> <b>Alıcı: </b> {buyer}\n                                </p>\n                                <p className=\"col-md-6 \">\n                                    <FontAwesomeIcon icon={faMoneyBill} width=\"16\" /> <b>Satış Fiyatı: </b> {salePrice}₺\n                                </p>\n                                <p className=\"col-md-12 mb-4\">\n                                    <FontAwesomeIcon icon={faCalendarAlt} width=\"16\" /> <b>Kapanış Tarihi: </b>\n                                    {toTimeString(this.state.sale.endDate)}\n                                </p>\n                            </div>\n                        </div>\n                        <div className=\"col-md-1\"></div>\n                        <div className=\"col-md-5\">\n                            <ChatBox buyer={buyer}\n                                     saleId={this.state.sale._id}\n                                     salePrice={salePrice}\n                                     userToken={this.props.token}\n                                     userEmail={this.state.user.email}\n                                     receiverEmail={this.state.maxBid.bidder.email} />\n                        </div>\n                    </div>\n                </div>\n            </Layout>\n        );\n    }\n}\n\nSale.getInitialProps = async ctx => {\n    const {id} = ctx.query;\n\n    // Check user's session\n    const token = auth(ctx);\n\n    return { id, token }\n};\n\nexport default Sale;"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;AACA;AAAA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AARA;AASA;AACA;;;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;;;AACA;AACA;AACA;AAEA;AACA;AADA;AAGA;;;AACA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AADA;AADA;AAKA;AACA;AAAA;AACA;AADA;AACA;AAEA;AACA;AACA;AAFA;AACA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AADA;AADA;AAKA;AACA;AADA;AAGA;AACA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AATA;AAAA;AAAA;AAAA;AAAA;AAAA;AAoBA;;;;AArIA;AACA;AAuIA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;AACA;AAAA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAFA;AAJA;AAHA;AAeA;AACA;;;AAAA;AAAA;AACA;AAAA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAIA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWA;;;;AA7EA;AACA;AA+EA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AAJA;AAMA;AAAA;AAAA;AACA;AAPA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAQA;;;;A","sourceRoot":""}