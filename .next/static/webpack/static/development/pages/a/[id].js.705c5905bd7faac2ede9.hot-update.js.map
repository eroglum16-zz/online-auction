{"version":3,"file":"static/webpack/static/development/pages/a/[id].js.705c5905bd7faac2ede9.hot-update.js","sources":["webpack:///./pages/a/.js"],"sourcesContent":["import Layout from '../../components/AppLayout';\nimport Bidding from \"../../components/Bidding\";\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport { Button, Form, FormGroup, Input, InputGroup, InputGroupAddon, InputGroupText, Badge, Alert, Fade } from 'reactstrap';\nimport {Carousel, CarouselItem, CarouselControl, CarouselIndicators, CarouselCaption} from 'reactstrap';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faLiraSign, faUser, faMoneyBill, faUsers, faThumbsUp, faCalendarAlt, faMapMarkerAlt } from '@fortawesome/free-solid-svg-icons'\nimport axios from \"axios\";\nimport { getToken } from '../../utils/auth';\n\n\nconst apiConfig = require('../../api-config');\nconst defaults = require('../../utils/defaults');\n\nimport socketIOClient from 'socket.io-client';\nconst socket = socketIOClient(apiConfig.serverUrl);\n\nclass AuctionDetail extends React.Component{\n    constructor(props) {\n        super(props);\n        var token = this.props.token;\n        this.getUser(token);\n\n        this.state = {\n            loggedIn: token ? true : false,\n            user: {},\n            bid: \"\",\n            activeIndex: 0,\n            animating: false,\n            sale: defaults.defaultSale,\n            maxBid:{\n                amount: null,\n                bidder: \"\"\n            },\n            biddingFade: {\n                message: \"\",\n                in: false\n            }\n        };\n        this.handleNewBid = this.handleNewBid.bind(this);\n        this.handleInputChange  = this.handleInputChange.bind(this);\n        this.getSale = this.getSale.bind(this);\n        this.handleKeyDown = this.handleKeyDown.bind(this);\n    }\n    componentDidMount(){\n        const saleId = this.props.id;\n        this.getSale(saleId);\n        this.setState({bid: \"\"});\n        socket.on('bid update on ' + saleId, (msg) => {\n            if(msg.saleId === saleId){\n                this.getSale(saleId);\n            }\n        });\n    }\n    handleInputChange(event) {\n        const target = event.target;\n        const value = target.value;\n        const name = target.name;\n\n        this.setState({\n            [name]: value,\n        });\n    }\n    handleKeyDown(event) {\n        if (event.key === 'Enter') {\n            this.handleNewBid();\n            this.getSale(this.state.sale._id);\n        }\n    }\n    handleNewBid(){\n        if (this.state.bid === \"\"){\n            this.showFade(\"Önce teklifinizi girin.\");\n            return;\n        }\n        if (this.state.bid < this.state.sale.firstPrice){\n            this.showFade(\"Başlangıç fiyatından düşük teklif veremezsiniz. (\" + this.state.sale.firstPrice + \"₺)\");\n            this.setState({\n                bid: \"\"\n            });\n            return;\n        }\n        if (this.state.bid < this.state.maxBid.amount){\n            this.showFade(\"En yüksek tekliften düşük teklif veremezsiniz. (\" + this.state.maxBid.amount + \"₺)\");\n            return;\n        }\n        if (this.state.bid == this.state.maxBid.amount){\n            this.showFade(this.state.bid + \"₺ en yüksek teklif, aynı teklifi vermezsiniz.\");\n            return;\n        }\n\n        socket.emit('new bid', {\n            saleId: this.state.sale._id,\n            bid: {\n                amount: parseInt(this.state.bid),\n                bidder: this.state.user.email\n            }\n        });\n    }\n    showFade(message){\n\n        this.setState({biddingFade: {\n                message: message,\n                in: true\n            }});\n\n        setInterval(() => {\n            this.setState({\n                biddingFade: {\n                    message:\"\",\n                    in:false\n                }\n            });\n        },60000);\n\n    }\n    getUser(token){\n        const url = apiConfig.serverUrl + '/user/get';\n        axios.post(url, {}, {\n            headers:{\n                authorization: token\n            }})\n            .then((response) => {\n                this.setState({\n                    user: response.data.user\n                });\n            })\n            .catch(function (error) {\n                console.log(error);\n            }.bind(this));\n    }\n    getSale(id){\n        const url = apiConfig.serverUrl + '/sale/' + id;\n        axios.get(url)\n            .then((response) => {\n                var maxBid = response.data.sale.bids.length === 0 ? {\n                    bidder: \"\",\n                    amount: 0\n                }\n                :\n                    response.data.sale.bids.reduce((a, b) => {\n                    return a.amount > b.amount ? a : b;\n                });\n                var sale = response.data.sale;\n                sale.isActive = (Date.now() < sale.endDate);\n                this.setState({\n                    sale: sale,\n                    maxBid: maxBid\n                });\n            })\n            .catch((error) => {\n                console.log(error);\n                //if(!error.response) Router.push('/index');\n                //if(error.response.status === 404) Router.push('/index');\n            })\n    }\n    render() {\n        var loggedIn = this.state.loggedIn;\n        const userEmail = this.state.user ? this.state.user.email : \"\";\n\n        const images = this.state.sale.images;\n        const items = [];\n\n        var i;\n        for(i in images){\n            items.push({\n                src: apiConfig.serverUrl + '/images/products/' + images[i],\n                altText: this.state.sale.title,\n                caption: this.state.sale.title\n            });\n        }\n\n        const next = () => {\n            if (this.state.animating) return;\n            const nextIndex = this.state.activeIndex === items.length - 1 ? 0 : this.state.activeIndex + 1;\n            this.setState({\n                activeIndex: nextIndex\n            });\n        };\n\n        const previous = () => {\n            if (this.state.animating) return;\n            const nextIndex = this.state.activeIndex === 0 ? items.length - 1 : this.state.activeIndex - 1;\n            this.setState({\n                activeIndex: nextIndex\n            });\n        };\n\n        const goToIndex = (newIndex) => {\n            if (this.state.animating) return;\n            this.setState({\n                activeIndex: newIndex\n            });\n        };\n\n        const slides = items.map((item) => {\n            return (\n                <CarouselItem className=\"text-center\"\n                    onExiting={() => this.setState({animating:true})}\n                    onExited={() => this.setState({animating:false})}\n                    key={item.src}\n                >\n                    <img style={{maxHeight: '300px'}} src={item.src} alt={item.altText} />\n                </CarouselItem>\n            );\n        });\n\n        const date = new Date(this.state.sale.endDate);\n        const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };\n        const endDate = this.state.sale.endDate === 0 ? \"-\" : date.toLocaleDateString('tr-TR', options);\n\n        return (\n            <Layout page=\"home\" user={this.state.user} loggedIn={this.state.loggedIn}>\n                <div className=\"container bg-white\" style={{ padding:'3%', marginTop:'3%', boxShadow: '0px 10px 5px 0px #ccc'}} >\n                    <h2> {this.state.sale.title} {userEmail === this.state.sale.owner.email ?\n                        <Badge className=\"ml-2\" color=\"dark\" pill>Sizin ilanınız</Badge> : \"\"\n                    }\n                        <span className=\"float-right\">\n\n                        </span>\n                    </h2>\n                    <hr/>\n                    <p style={{fontFamily:'verdana', fontSize:'17px', marginBottom:'50px'}}>\n                        {this.state.sale.description}\n                    </p>\n                    <div className=\"row\">\n                        <div className=\"col-md-8\">\n                            <Carousel\n                                activeIndex={this.state.activeIndex}\n                                next={next}\n                                previous={previous}\n                            >\n                                <CarouselIndicators items={items}\n                                                    activeIndex={this.state.activeIndex}\n                                                    onClickHandler={goToIndex} />\n                                {slides}\n                                <CarouselControl direction=\"prev\" directionText=\"Previous\" onClickHandler={previous} />\n                                <CarouselControl direction=\"next\" directionText=\"Next\" onClickHandler={next} />\n                            </Carousel>\n                        </div>\n                        <div className=\"col-md-4 pt-4\">\n                            <Bidding loggedIn={loggedIn}\n                                     saleOwner={this.state.sale.owner.email === this.state.user.email}\n                                     finishedSale={!this.state.sale.isActive}\n                                     maxBidder={this.state.maxBid.bidder === this.state.user.email}\n                                     bid={this.state.bid}\n                                     biddingFade={this.state.biddingFade}\n                                     endDate={this.state.sale.endDate}\n                                     maxBid={this.state.maxBid}\n                                     handleInputChange={this.handleInputChange}\n                                     handleKeyDown={this.handleKeyDown}\n                                     handleNewBid={this.handleNewBid}\n                                     />\n                        </div>\n                    </div>\n                    <div className=\"row\">\n                        <div className=\"col-md-4\">\n                            <p className=\"mb-4 mt-4\">\n                                <FontAwesomeIcon icon={faUser} width=\"16\" /> <b>Satıcı: </b>\n                                {this.state.sale.owner.nameSurname}\n                            </p>\n                            <p className=\"mb-4\">\n                                <FontAwesomeIcon icon={faMoneyBill} width=\"16\" /> <b>Başlangıç Fiyatı: </b>\n                                {this.state.sale.firstPrice}₺\n                            </p>\n                        </div>\n                        <div className=\"col-md-4\">\n                            <p className=\"mb-4 mt-4\">\n                                <FontAwesomeIcon icon={faUsers} width=\"16\" /> <b>Teklif sayısı: </b>\n                                {this.state.sale.bids.length}\n                            </p>\n                            <p className=\"mb-4\">\n                                <FontAwesomeIcon icon={faThumbsUp} width=\"16\" /> <b>Durum: </b>\n                                {this.state.sale.state}\n                            </p>\n                        </div>\n                        <div className=\"col-md-4\">\n                            <p className=\"mb-4 mt-4\">\n                                <FontAwesomeIcon icon={faCalendarAlt} width=\"16\" /> <b>Kapanış: </b>\n                                {endDate}\n                            </p>\n                            <p>\n                                <FontAwesomeIcon icon={faMapMarkerAlt} width=\"16\" /> <b>Konum: </b>\n                                {this.state.sale.city}, {this.state.sale.district}\n                            </p>\n                        </div>\n                    </div>\n                </div>\n            </Layout>\n        );\n    }\n}\n\nAuctionDetail.getInitialProps = async function(context) {\n\n    const {id} = context.query;\n\n    const token = getToken(context);\n\n    return {id, token};\n\n};\n\nexport default AuctionDetail;"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;AACA;AAAA;AACA;AADA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAXA;AAgBA;AACA;AACA;AACA;AAxBA;AAyBA;AACA;;;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;AAEA;AAGA;;;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAFA;AAOA;;;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAAA;AAKA;AACA;AACA;AACA;AACA;AAFA;AADA;AAMA;AAEA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AADA;AADA;AAKA;AACA;AADA;AAGA;AAEA;AACA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AAEA;AACA;AACA;AAFA;AAMA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAIA;AAEA;AAEA;AACA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AACA;AACA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAVA;AAAA;AAAA;AAAA;AAAA;AAAA;AAcA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;;;;AAhRA;AACA;AAkRA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAEA;AAJA;AAMA;AAAA;AAAA;AACA;AAPA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AASA;;;;A","sourceRoot":""}