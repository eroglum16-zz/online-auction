{"ast":null,"code":"import _Date$now from \"@babel/runtime-corejs2/core-js/date/now\";\nimport Router from 'next/router';\nimport nextCookie from 'next-cookies';\nimport cookie from '../node_modules/js-cookie';\nimport axios from \"axios\";\n\nconst apiConfig = require('../api-config');\n\nexport const login = ({\n  token\n}) => {\n  cookie.set('token', token, {\n    expires: 1\n  });\n  Router.push('/index');\n};\nexport const auth = ctx => {\n  const {\n    token\n  } = nextCookie(ctx);\n\n  if (ctx.req && !token) {\n    ctx.res.writeHead(302, {\n      Location: '/login'\n    });\n    ctx.res.end();\n    return;\n  }\n\n  if (!token) {\n    Router.push('/login');\n  }\n\n  return token;\n};\nexport const guest = ctx => {\n  const {\n    token\n  } = nextCookie(ctx);\n\n  if (ctx.req && token) {\n    ctx.res.writeHead(302, {\n      Location: '/index'\n    });\n    ctx.res.end();\n    return;\n  }\n\n  if (token) {\n    Router.push('/index');\n  }\n\n  return;\n};\nexport const getToken = ctx => {\n  const {\n    token\n  } = nextCookie(ctx);\n  return token;\n};\nexport const getUser = token => {\n  const url = apiConfig.serverUrl + '/user/get';\n  axios.post(url, {}, {\n    headers: {\n      authorization: token\n    }\n  }).then(response => {\n    this.setState({\n      user: response.data.user\n    });\n  }).catch(function (error) {\n    console.log(error);\n  });\n};\nexport const logout = () => {\n  cookie.remove('token'); // to support logging out from all windows\n\n  window.localStorage.setItem('logout', _Date$now());\n  Router.push('/login');\n};","map":{"version":3,"sources":["/Users/mert/Desktop/İTÜ/Fall 2019/Bitirme/Project/utils/auth.js"],"names":["Router","nextCookie","cookie","axios","apiConfig","require","login","token","set","expires","push","auth","ctx","req","res","writeHead","Location","end","guest","getToken","getUser","url","serverUrl","post","headers","authorization","then","response","setState","user","data","catch","error","console","log","logout","remove","window","localStorage","setItem"],"mappings":";AAAA,OAAOA,MAAP,MAAmB,aAAnB;AACA,OAAOC,UAAP,MAAuB,cAAvB;AACA,OAAOC,MAAP,MAAmB,2BAAnB;AAEA,OAAOC,KAAP,MAAkB,OAAlB;;AACA,MAAMC,SAAS,GAAGC,OAAO,CAAC,eAAD,CAAzB;;AAEA,OAAO,MAAMC,KAAK,GAAG,CAAC;AAAEC,EAAAA;AAAF,CAAD,KAAe;AAChCL,EAAAA,MAAM,CAACM,GAAP,CAAW,OAAX,EAAoBD,KAApB,EAA2B;AAAEE,IAAAA,OAAO,EAAE;AAAX,GAA3B;AACAT,EAAAA,MAAM,CAACU,IAAP,CAAY,QAAZ;AACH,CAHM;AAKP,OAAO,MAAMC,IAAI,GAAGC,GAAG,IAAI;AACvB,QAAM;AAAEL,IAAAA;AAAF,MAAYN,UAAU,CAACW,GAAD,CAA5B;;AAEA,MAAIA,GAAG,CAACC,GAAJ,IAAW,CAACN,KAAhB,EAAuB;AACnBK,IAAAA,GAAG,CAACE,GAAJ,CAAQC,SAAR,CAAkB,GAAlB,EAAuB;AAAEC,MAAAA,QAAQ,EAAE;AAAZ,KAAvB;AACAJ,IAAAA,GAAG,CAACE,GAAJ,CAAQG,GAAR;AACA;AACH;;AAED,MAAI,CAACV,KAAL,EAAY;AACRP,IAAAA,MAAM,CAACU,IAAP,CAAY,QAAZ;AACH;;AAED,SAAOH,KAAP;AACH,CAdM;AAgBP,OAAO,MAAMW,KAAK,GAAGN,GAAG,IAAI;AACxB,QAAM;AAAEL,IAAAA;AAAF,MAAYN,UAAU,CAACW,GAAD,CAA5B;;AAEA,MAAIA,GAAG,CAACC,GAAJ,IAAWN,KAAf,EAAsB;AAClBK,IAAAA,GAAG,CAACE,GAAJ,CAAQC,SAAR,CAAkB,GAAlB,EAAuB;AAAEC,MAAAA,QAAQ,EAAE;AAAZ,KAAvB;AACAJ,IAAAA,GAAG,CAACE,GAAJ,CAAQG,GAAR;AACA;AACH;;AAED,MAAIV,KAAJ,EAAW;AACPP,IAAAA,MAAM,CAACU,IAAP,CAAY,QAAZ;AACH;;AAED;AACH,CAdM;AAgBP,OAAO,MAAMS,QAAQ,GAAGP,GAAG,IAAI;AAC3B,QAAM;AAAEL,IAAAA;AAAF,MAAYN,UAAU,CAACW,GAAD,CAA5B;AAEA,SAAOL,KAAP;AACH,CAJM;AAMP,OAAO,MAAMa,OAAO,GAAGb,KAAK,IAAI;AAC5B,QAAMc,GAAG,GAAGjB,SAAS,CAACkB,SAAV,GAAsB,WAAlC;AACAnB,EAAAA,KAAK,CAACoB,IAAN,CAAWF,GAAX,EAAgB,EAAhB,EAAoB;AAChBG,IAAAA,OAAO,EAAC;AACJC,MAAAA,aAAa,EAAElB;AADX;AADQ,GAApB,EAIKmB,IAJL,CAIWC,QAAD,IAAc;AAChB,SAAKC,QAAL,CAAc;AACVC,MAAAA,IAAI,EAAEF,QAAQ,CAACG,IAAT,CAAcD;AADV,KAAd;AAGH,GARL,EASKE,KATL,CASW,UAAUC,KAAV,EAAiB;AACpBC,IAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACH,GAXL;AAYH,CAdM;AAgBP,OAAO,MAAMG,MAAM,GAAG,MAAM;AACxBjC,EAAAA,MAAM,CAACkC,MAAP,CAAc,OAAd,EADwB,CAExB;;AACAC,EAAAA,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,QAA5B,EAAsC,WAAtC;AACAvC,EAAAA,MAAM,CAACU,IAAP,CAAY,QAAZ;AACH,CALM","sourcesContent":["import Router from 'next/router'\nimport nextCookie from 'next-cookies'\nimport cookie from '../node_modules/js-cookie'\n\nimport axios from \"axios\";\nconst apiConfig = require('../api-config');\n\nexport const login = ({ token }) => {\n    cookie.set('token', token, { expires: 1 })\n    Router.push('/index')\n};\n\nexport const auth = ctx => {\n    const { token } = nextCookie(ctx);\n\n    if (ctx.req && !token) {\n        ctx.res.writeHead(302, { Location: '/login' });\n        ctx.res.end();\n        return\n    }\n\n    if (!token) {\n        Router.push('/login')\n    }\n\n    return token\n};\n\nexport const guest = ctx => {\n    const { token } = nextCookie(ctx);\n\n    if (ctx.req && token) {\n        ctx.res.writeHead(302, { Location: '/index' });\n        ctx.res.end();\n        return\n    }\n\n    if (token) {\n        Router.push('/index');\n    }\n\n    return;\n};\n\nexport const getToken = ctx => {\n    const { token } = nextCookie(ctx);\n\n    return token\n};\n\nexport const getUser = token => {\n    const url = apiConfig.serverUrl + '/user/get';\n    axios.post(url, {}, {\n        headers:{\n            authorization: token\n        }})\n        .then((response) => {\n            this.setState({\n                user: response.data.user\n            });\n        })\n        .catch(function (error) {\n            console.log(error);\n        });\n};\n\nexport const logout = () => {\n    cookie.remove('token')\n    // to support logging out from all windows\n    window.localStorage.setItem('logout', Date.now())\n    Router.push('/login')\n};"]},"metadata":{},"sourceType":"module"}